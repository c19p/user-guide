<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuring the Agent - The C19 Protocol / User Guide</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title-page.html">The C19 Protocol</a></li><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="motivation.html">Motivation</a></li><li class="chapter-item expanded "><a href="use-cases.html"><strong aria-hidden="true">1.</strong> Use cases</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="use-case-sharing-state.html"><strong aria-hidden="true">1.1.</strong> Sharing state</a></li><li class="chapter-item expanded "><a href="use-case-media-server.html"><strong aria-hidden="true">1.2.</strong> Media Service / Pulling from Origin</a></li><li class="chapter-item expanded "><a href="use-case-user-subscription.html"><strong aria-hidden="true">1.3.</strong> User Subscription Data</a></li><li class="chapter-item expanded "><a href="use-case-standalone-cache.html"><strong aria-hidden="true">1.4.</strong> Standalone Distributed Cache</a></li></ol></li><li class="chapter-item expanded "><a href="ch01-00-getting-started.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dockerhub.html"><strong aria-hidden="true">2.1.</strong> Dockerhub</a></li><li class="chapter-item expanded "><a href="getting-started-configuration.html" class="active"><strong aria-hidden="true">2.2.</strong> Configuring the Agent</a></li><li class="chapter-item expanded "><a href="getting-started-deploying-to-kubernetes.html"><strong aria-hidden="true">2.3.</strong> Deploying to Kubernetes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started-tldr.html"><strong aria-hidden="true">2.3.1.</strong> TL;DR</a></li><li class="chapter-item expanded "><a href="getting-started-step-by-step.html"><strong aria-hidden="true">2.3.2.</strong> Step-by-Step</a></li></ol></li><li class="chapter-item expanded "><a href="getting-started-test-deployment.html"><strong aria-hidden="true">2.4.</strong> Testing the Deployment</a></li><li class="chapter-item expanded "><a href="getting-started-helm-deployment.html"><strong aria-hidden="true">2.5.</strong> Standalone Deployment Using Helm Chart</a></li><li class="chapter-item expanded "><a href="getting-started-non-kubernetes-deployment.html"><strong aria-hidden="true">2.6.</strong> Non-Kubernetes Deployment</a></li><li class="chapter-item expanded "><a href="setting-and-getting-values.html"><strong aria-hidden="true">2.7.</strong> Setting and Getting Values</a></li></ol></li><li class="chapter-item expanded "><a href="deployment-strategies.html"><strong aria-hidden="true">3.</strong> Deployment Strategies</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployment-strategy-classic.html"><strong aria-hidden="true">3.1.</strong> Alongside a Service</a></li><li class="chapter-item expanded "><a href="deployment-strategy-standalone.html"><strong aria-hidden="true">3.2.</strong> As a Standalone Cluster</a></li><li class="chapter-item expanded "><a href="deployment-strategy-daemonset.html"><strong aria-hidden="true">3.3.</strong> As a Daemonset</a></li><li class="chapter-item expanded "><a href="deployment-strategy-hybrid.html"><strong aria-hidden="true">3.4.</strong> A Hybrid Deployment</a></li></ol></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-state-layer.html"><strong aria-hidden="true">4.1.</strong> The State Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-default-state.html"><strong aria-hidden="true">4.1.1.</strong> The Default State</a></li><li class="chapter-item expanded "><a href="data-seeders.html"><strong aria-hidden="true">4.1.2.</strong> Data Seeders</a></li></ol></li><li class="chapter-item expanded "><a href="the-agent-layer.html"><strong aria-hidden="true">4.2.</strong> The Agent Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-default-agent.html"><strong aria-hidden="true">4.2.1.</strong> The Default Agent</a></li></ol></li><li class="chapter-item expanded "><a href="the-connection-layer.html"><strong aria-hidden="true">4.3.</strong> The Connection Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-default-connection.html"><strong aria-hidden="true">4.3.1.</strong> The Default Connection</a></li><li class="chapter-item expanded "><a href="peer-providers.html"><strong aria-hidden="true">4.3.2.</strong> Peer Providers</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">5.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="seeding-data.html"><strong aria-hidden="true">6.</strong> Seeding Data</a></li><li class="chapter-item expanded "><a href="appendix-i.html"><strong aria-hidden="true">7.</strong> Appendix I</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-states.html"><strong aria-hidden="true">7.1.</strong> Available States</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-default-state.html"><strong aria-hidden="true">7.1.1.</strong> The Default State</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-agents.html"><strong aria-hidden="true">7.2.</strong> Available Agents</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-default-agent.html"><strong aria-hidden="true">7.2.1.</strong> The Default Agent</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-connections.html"><strong aria-hidden="true">7.3.</strong> Available Connections</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-default-connection.html"><strong aria-hidden="true">7.3.1.</strong> The Default Connection</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-peer-providers.html"><strong aria-hidden="true">7.4.</strong> Available Peer Providers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-static-peer-provider.html"><strong aria-hidden="true">7.4.1.</strong> Static Peer Provider</a></li><li class="chapter-item expanded "><a href="appendix-i-k8s-peer-provider.html"><strong aria-hidden="true">7.4.2.</strong> K8s</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-data-seeders.html"><strong aria-hidden="true">7.5.</strong> Available Data Seeders</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-file-data-seeder.html"><strong aria-hidden="true">7.5.1.</strong> File Data Seeder</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="roadmap.html"><strong aria-hidden="true">8.</strong> Roadmap</a></li><li class="chapter-item expanded "><a href="license.html"><strong aria-hidden="true">9.</strong> License</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The C19 Protocol / User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#configuring-the-agent" id="configuring-the-agent">Configuring the Agent</a></h1>
<p>A C19 agent has 3 parts (layers): agent, state and connection.</p>
<p>We will go into details about each layer in the <a href="architecture.html">Architecture</a> chapter, but for now all you need to know is 
that the agent layer is responsible for communicating with your app, the connection layer is responsible for communicating with other 
C19 agents and the state layer is responsible for holding your data.</p>
<p>A C19 configuration file is a YAML formatted file. Let's prepare ours:</p>
<pre><code class="language-yaml">version: 0.1
spec:
  agent:
    kind: Default
    port: 3097
  state:
    kind: Default
    ttl: null
    purge_interval: 60000
  connection:
    kind: Default
    port: 4097
    push_interval: 1000
    pull_interval: 60000
    r0: 3
    timeout: 1000
    peer_provider:
      kind: K8s
      selector:
        c19: getting-started
      namespace: default
</code></pre>
<p>As you can see, we have our 3 layer configurations: agent, state and connection. Every section starts with the <code>kind</code> configuration which 
tells C19 which kind of agent/state/connection to load. As you will learn, there can be different types of layer implementations, each would 
suit different needs.</p>
<h2><a class="header" href="#agent" id="agent">Agent</a></h2>
<p><code>kind</code> - We will use the &quot;Default&quot; agent layer. For now, it's enough for you to know that the &quot;Default&quot; agent provides a HTTP server which 
accepts a JSON formatted calls for getting and setting values to the state.</p>
<p><code>port</code> - The port to use for the agent HTTP server. The default value, if unspecified, is 3097.</p>
<h2><a class="header" href="#state" id="state">State</a></h2>
<p><code>kind</code> - Same as the Agent, we will use the &quot;Default&quot; state implementation. The &quot;Default&quot; state implementation provides a key-value store 
with an option to set a TTL for each key.</p>
<p><code>ttl</code> - The TTL to use (in milliseconds). If left out there will be no default TTL set for keys. In any case, as you will learn, you can always set a TTL for a 
key when setting a value to the state. Default value is no ttl.</p>
<p><code>purge_interval</code> - The Default state will always filter out expired keys, but will still hold them in memory until purged. This setting controls the 
interval (in milliseconds) in which expired keys will be purged. Default value is 1 minute.</p>
<h2><a class="header" href="#connection" id="connection">Connection</a></h2>
<p><code>kind</code> - We will use the &quot;Default&quot; connection layer implementation. The &quot;Default&quot; connection uses HTTP to exchange the state with other C19 peers. 
It randomly chooses peers to connect to and exchanges the state at a specified interval.</p>
<p><code>port</code> - The port to use when connecting to other peers and allowing other peers to connect to this C19 agent. Default port is 4097.</p>
<p><code>push_interval</code> - Controls the interval (in milliseconds) in which the connection layer will connect and push the state to a random set of C19 peers. Default value is 1 second. 
Setting this value higher will speed up propagation of the state in the system, but would come at the expense of CPU usage.</p>
<p><code>pull_interval</code> - Controls the interval (in milliseconds) in which the connection layer will connect and pull the state from a random set of C19 peers. Default value is 60 seconds.
The connection layer will specify its own state version when pulling the state from other peers. If the state versions match then no state will be exchanged. This is to optimize 
redundant state exchanges. If the versions do not match then the full state will be returned by the connected peer.</p>
<p><code>r0</code>: Controls how many peers should this connection layer connect to at each publish interval. Setting this value higher will speed up propagation 
of the state in the system, but would come at the expense of network load. (connecting to more peers). Default value is 3.</p>
<p><code>timeout</code> - Controls the connection timeout (in milliseconds) when exchanging state with each peer. Default value is 1 second.</p>
<p><code>peer_provider</code> - At each <code>publish_interval</code>, the connection layer will query the peer provider for a full list of available peers to choose from. There are 
different types of peer providers. For example: Kubernetes peer provider that queries for pod endpoints based on a label selector and a static peer provider which allows specifying a predefined 
list of peer endpoints. Since we will be deploying to a Kubernetes cluster we will be using the K8s 
peer provider.</p>
<h3><a class="header" href="#k8s-peer-provider" id="k8s-peer-provider">K8s Peer Provider</a></h3>
<p><code>kind</code> - Controls the type of peer provider to use. Default value is <code>K8s</code></p>
<p><code>selector</code> - Sets the Kubernetes pod label selector which will form a C19 group. Default value is none which means all pods will be used for the same C19 group. 
This option allows you to have many different C19 groups. Each group will have its own isolated state shared.</p>
<p><code>namespace</code> - The Kubernetes namespace to use. Defaults to the <code>default</code> namespace. Can also be set to <code>:all</code> (mind the <code>:</code>) to specify that all namespaces should be used.</p>
<h2><a class="header" href="#applying-the-configuration" id="applying-the-configuration">Applying the Configuration</a></h2>
<p>You specify the configuration file to use when running a C19 agent by using the <code>--config &lt;filename&gt;</code> flag.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="dockerhub.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="getting-started-deploying-to-kubernetes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="dockerhub.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="getting-started-deploying-to-kubernetes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
