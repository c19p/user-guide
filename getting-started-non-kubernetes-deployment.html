<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Non-Kubernetes Deployment - The C19 Protocol / User Guide</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title-page.html">The C19 Protocol</a></li><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="motivation.html">Motivation</a></li><li class="chapter-item expanded "><a href="use-cases.html"><strong aria-hidden="true">1.</strong> Use cases</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="use-case-sharing-state.html"><strong aria-hidden="true">1.1.</strong> Sharing state</a></li><li class="chapter-item expanded "><a href="use-case-media-server.html"><strong aria-hidden="true">1.2.</strong> Media Service / Pulling from Origin</a></li><li class="chapter-item expanded "><a href="use-case-user-subscription.html"><strong aria-hidden="true">1.3.</strong> User Subscription Data</a></li><li class="chapter-item expanded "><a href="use-case-standalone-cache.html"><strong aria-hidden="true">1.4.</strong> Standalone Distributed Cache</a></li></ol></li><li class="chapter-item expanded "><a href="ch01-00-getting-started.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dockerhub.html"><strong aria-hidden="true">2.1.</strong> Dockerhub</a></li><li class="chapter-item expanded "><a href="getting-started-configuration.html"><strong aria-hidden="true">2.2.</strong> Configuring the Agent</a></li><li class="chapter-item expanded "><a href="getting-started-deploying-to-kubernetes.html"><strong aria-hidden="true">2.3.</strong> Deploying to Kubernetes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started-tldr.html"><strong aria-hidden="true">2.3.1.</strong> TL;DR</a></li><li class="chapter-item expanded "><a href="getting-started-step-by-step.html"><strong aria-hidden="true">2.3.2.</strong> Step-by-Step</a></li></ol></li><li class="chapter-item expanded "><a href="getting-started-test-deployment.html"><strong aria-hidden="true">2.4.</strong> Testing the Deployment</a></li><li class="chapter-item expanded "><a href="getting-started-helm-deployment.html"><strong aria-hidden="true">2.5.</strong> Standalone Deployment Using Helm Chart</a></li><li class="chapter-item expanded "><a href="getting-started-non-kubernetes-deployment.html" class="active"><strong aria-hidden="true">2.6.</strong> Non-Kubernetes Deployment</a></li><li class="chapter-item expanded "><a href="setting-and-getting-values.html"><strong aria-hidden="true">2.7.</strong> Setting and Getting Values</a></li></ol></li><li class="chapter-item expanded "><a href="deployment-strategies.html"><strong aria-hidden="true">3.</strong> Deployment Strategies</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployment-strategy-classic.html"><strong aria-hidden="true">3.1.</strong> Alongside a Service</a></li><li class="chapter-item expanded "><a href="deployment-strategy-standalone.html"><strong aria-hidden="true">3.2.</strong> As a Standalone Cluster</a></li><li class="chapter-item expanded "><a href="deployment-strategy-daemonset.html"><strong aria-hidden="true">3.3.</strong> As a Daemonset</a></li><li class="chapter-item expanded "><a href="deployment-strategy-hybrid.html"><strong aria-hidden="true">3.4.</strong> A Hybrid Deployment</a></li></ol></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-state-layer.html"><strong aria-hidden="true">4.1.</strong> The State Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-default-state.html"><strong aria-hidden="true">4.1.1.</strong> The Default State</a></li><li class="chapter-item expanded "><a href="data-seeders.html"><strong aria-hidden="true">4.1.2.</strong> Data Seeders</a></li></ol></li><li class="chapter-item expanded "><a href="the-agent-layer.html"><strong aria-hidden="true">4.2.</strong> The Agent Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-default-agent.html"><strong aria-hidden="true">4.2.1.</strong> The Default Agent</a></li></ol></li><li class="chapter-item expanded "><a href="the-connection-layer.html"><strong aria-hidden="true">4.3.</strong> The Connection Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-default-connection.html"><strong aria-hidden="true">4.3.1.</strong> The Default Connection</a></li><li class="chapter-item expanded "><a href="peer-providers.html"><strong aria-hidden="true">4.3.2.</strong> Peer Providers</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">5.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="seeding-data.html"><strong aria-hidden="true">6.</strong> Seeding Data</a></li><li class="chapter-item expanded "><a href="appendix-i.html"><strong aria-hidden="true">7.</strong> Appendix I</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-states.html"><strong aria-hidden="true">7.1.</strong> Available States</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-default-state.html"><strong aria-hidden="true">7.1.1.</strong> The Default State</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-agents.html"><strong aria-hidden="true">7.2.</strong> Available Agents</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-default-agent.html"><strong aria-hidden="true">7.2.1.</strong> The Default Agent</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-connections.html"><strong aria-hidden="true">7.3.</strong> Available Connections</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-default-connection.html"><strong aria-hidden="true">7.3.1.</strong> The Default Connection</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-peer-providers.html"><strong aria-hidden="true">7.4.</strong> Available Peer Providers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-static-peer-provider.html"><strong aria-hidden="true">7.4.1.</strong> Static Peer Provider</a></li><li class="chapter-item expanded "><a href="appendix-i-k8s-peer-provider.html"><strong aria-hidden="true">7.4.2.</strong> K8s</a></li></ol></li><li class="chapter-item expanded "><a href="appendix-i-data-seeders.html"><strong aria-hidden="true">7.5.</strong> Available Data Seeders</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-i-file-data-seeder.html"><strong aria-hidden="true">7.5.1.</strong> File Data Seeder</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="roadmap.html"><strong aria-hidden="true">8.</strong> Roadmap</a></li><li class="chapter-item expanded "><a href="license.html"><strong aria-hidden="true">9.</strong> License</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The C19 Protocol / User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#non-kubernetes-deployment" id="non-kubernetes-deployment">Non-Kubernetes Deployment</a></h1>
<p>If you are not running a Kubernetes cluster or you want to test C19 locally without a Kubernetes cluster, you can easily do so by using the Static Peer Provider.</p>
<p>As you've learned in previous chapters, the Connection layer uses a Peer Provider to query for available peers to choose from. The peer provider we've been using so far was 
K8s since we deployed and used C19 inside a Kubernetes cluster. But that doesn't mean we can't use it outside of a Kuernetes cluster.</p>
<h1><a class="header" href="#the-static-peer-provider" id="the-static-peer-provider">The Static Peer Provider</a></h1>
<p>The static peer provider allows us to manually and statically specify the peers that are available in our C19 group.</p>
<pre><code class="language-yaml">  connection:
    kind: Default
    push_interval: 1000
    pull_interval: 60000
    port: 4097
    target_port: 4097
    r0: 3
    timeout: 1000
    peer_provider:
      kind: Static
      peers:
        - 192.168.1.2
        - 192.168.86.204
</code></pre>
<p>The connection configuration above uses the static peer provider with 2 available peers in the group. You can specify how many you want.
The port that will be used by the connection layer is determined as follows, by this order:</p>
<ol>
<li>The static peer provider includes the port with a peer. For example: <code>192.168.1.2:5097</code></li>
<li><code>target_port</code> is specified</li>
<li>If non of the above exist then <code>port</code> will be used as the target port.</li>
</ol>
<h1><a class="header" href="#docker-compose" id="docker-compose">Docker Compose</a></h1>
<p>There are different ways you can run C19 on your local machine. For this demonstration and for the sake of simplicity, we will use docker-compose.</p>
<p>If you'd like to deploy without Docker then you'd have to pull the source code from the C19 Github 
repository and compile it using Rust. If you are familiar with Rust then you should find the procedure for compiling straight forward. Just 
use <code>cargo build --release</code> and you're done.</p>
<p>After you have <code>c19</code> binary ready, you can move forward with the following steps and make the proper adjustments when things are specifically relevant 
for Docker deployment.</p>
<h1><a class="header" href="#1-configuring-for-local-deployment" id="1-configuring-for-local-deployment">1. Configuring for Local Deployment</a></h1>
<p>So now that we know all about the static peer provider, let's configure it so we can then deploy a C19 cluster on our local machine.</p>
<p>We will use the following configuration for our C19 agents:</p>
<pre><code class="language-yaml">version: 0.1
spec:
  agent:
    kind: Default
    port: 3097
  state:
    kind: Default
    ttl: null
    purge_interval: 10000
  connection:
    kind: Default
    push_interval: 1000
    pull_interval: 60000
    port: 4097
    r0: 3
    timeout: 1000
    peer_provider:
      kind: Static
      peers:
        - 192.168.0.2
        - 192.168.0.3
        - 192.168.0.4
</code></pre>
<p>Let's save this configuration as <code>config.yaml</code></p>
<h1><a class="header" href="#2-configuring-docker-compose" id="2-configuring-docker-compose">2. Configuring <code>docker-compose</code></a></h1>
<p>We will configure our docker-compose to use a network which will allow us to set a static IP address for each C19 agent.</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
x-c19: &amp;c19
  image: c19p/c19:0.1.0
  command: [&quot;./c19&quot;, &quot;--config&quot;, &quot;/etc/c19/config.yaml&quot;]
  environment:
    RUST_LOG: &quot;c19=info&quot;
  deploy:
    replicas: 1
  volumes:
    - &quot;./config.yaml:/etc/c19/config.yaml:ro&quot;

services:
  c191:
    &lt;&lt;: *c19
    networks:
      cluster:
        ipv4_address: 192.168.0.2
    ports:
      - &quot;3097:3097&quot;
      - &quot;4097:4097&quot;

  c192:
    &lt;&lt;: *c19
    networks:
      cluster:
        ipv4_address: 192.168.0.3
    ports:
      - &quot;3098:3097&quot;
      - &quot;4098:4097&quot;

  c193:
    &lt;&lt;: *c19
    networks:
      cluster:
        ipv4_address: 192.168.0.4
    ports:
      - &quot;3099:3097&quot;
      - &quot;4099:4097&quot;

networks:
  cluster:
    ipam:
      driver: default
      config:
        - subnet: &quot;192.168.0.0/24&quot;
</code></pre>
<p>Save this as <code>docker-compose.yaml</code></p>
<p>As you can see, we configured the <code>cluster</code> network and used the same <code>c19</code> service configuration except for the static IP address 
and the port mapping.</p>
<h1><a class="header" href="#3-running-the-c19-agents" id="3-running-the-c19-agents">3. Running the C19 Agents</a></h1>
<pre><code class="language-shell">docker-compose up
</code></pre>
<h1><a class="header" href="#4-inspecting-our-deployment" id="4-inspecting-our-deployment">4. Inspecting Our Deployment</a></h1>
<p>Let's inspect our deployment:</p>
<pre><code class="language-shell">$ docker-compose ps
      Name                    Command               State                       Ports                     
----------------------------------------------------------------------------------------------------------
resources_c191_1   ./c19 --config /etc/c19/co ...   Up      0.0.0.0:3097-&gt;3097/tcp, 0.0.0.0:4097-&gt;4097/tcp
resources_c192_1   ./c19 --config /etc/c19/co ...   Up      0.0.0.0:3098-&gt;3097/tcp, 0.0.0.0:4098-&gt;4097/tcp
resources_c193_1   ./c19 --config /etc/c19/co ...   Up      0.0.0.0:3099-&gt;3097/tcp, 0.0.0.0:4099-&gt;4097/tcp
</code></pre>
<p>We have three C19 agents as expected, exposing ports to our local host for our inspection.</p>
<p>You can now follow up with <a href="getting-started-test-deployment.html">Testing the Deployment</a> chapter to play around with your deployment.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="getting-started-helm-deployment.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="setting-and-getting-values.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="getting-started-helm-deployment.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="setting-and-getting-values.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
